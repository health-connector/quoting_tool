<div class="row pt-12">
  <div class="col-8 mt-2">
    <button class="btn btn-rounded btn-outline-info">
      <span class="cs-text">Cost shown for</span>
      <i class="fas fa-user ml-1"></i> {{ costShownText }}
    </button>
    Effective Date: <strong>{{ employerDetails?.effectiveDate | date: 'MMMM, y' }}</strong>
  </div>
  <div class="col-12 mt-4 mb-4">
    <h5 class="mb-3"><strong>Select a Benefit Model</strong></h5>
    @for (plan of planOptions; track plan; let i = $index) {
      <label class="radio-container mr-3" [hidden]="plan.view !== planType()"
        >{{ plan.value }}
        <input
          type="radio"
          name="radio"
          id="customRadioInline{{ i }}"
          name="customRadioInline"
          (click)="changePackageFilter(plan.key)"
        />
        <span class="checkmark"></span>
      </label>
    }
  </div>

  @if (!isLoading) {
    <div>
      <div class="row">
        <div class="col-12">
          <button
            type="button"
            class="btn mt-2 filter-btn"
            (click)="isCollapsed = !isCollapsed"
            [attr.aria-expanded]="!isCollapsed"
            aria-controls="collapseExample"
            [disabled]="!filterSelected"
          >
            <i [ngClass]="isCollapsed ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"></i>
            Filter
          </button>
          <div id="collapseExample" [ngbCollapse]="!isCollapsed" [@fadeInOut]>
            <div class="card shadow-1">
              <div class="card-body">
                <div class="row">
                  <div class="col-3">
                    <p class="heading-label">
                      Metal Level
                      @if (planType() !== 'dental') {
                        <i
                          class="far fa-question-circle ml-2"
                          placement="right"
                          [ngbTooltip]="getToolTip('metalLevel')"
                        ></i>
                      }
                    </p>
                    @for (metalLevel of metalLevelOptions; track metalLevel; let i = $index) {
                      <div class="custom-control custom-checkbox mr-sm-2 m-b-15">
                        <input
                          type="checkbox"
                          class="custom-control-input checkbox-input"
                          id="checkbox-metal-{{ i }}"
                          [value]="metalLevel"
                          (click)="selectedFilter(metalLevel, $event, 'metalLevel')"
                        />
                        <label class="custom-control-label" for="checkbox-metal-{{ i }}"
                          >{{ metalLevel | titlecase }}
                          <span class="count-text">{{ metalLevelCount(metalLevel) }}</span></label
                        >
                      </div>
                    }
                  </div>
                  <div class="col-3">
                    <p class="heading-label">
                      Plan Type
                      <i
                        class="far fa-question-circle ml-2"
                        placement="right"
                        [ngbTooltip]="getToolTip('planType')"
                      ></i>
                    </p>
                    @for (product of products; track product; let i = $index) {
                      <div class="custom-control custom-checkbox mr-sm-2 m-b-15">
                        <input
                          type="checkbox"
                          class="custom-control-input checkbox-input"
                          id="checkbox-plan-{{ i }}"
                          [value]="product"
                          (click)="selectedFilter(product, $event, 'productType')"
                        />
                        <label class="custom-control-label" for="checkbox-plan-{{ i }}"
                          >{{ product.toUpperCase() }}
                          <span class="count-text">{{ productTypeCounts(product) }}</span></label
                        >
                      </div>
                    }
                  </div>
                  <div class="col-3">
                    <p class="heading-label">
                      HSA Eligible
                      <i
                        class="far fa-question-circle ml-2"
                        placement="right"
                        [ngbTooltip]="getToolTip('hsaEligible')"
                      ></i>
                    </p>
                    @for (hsa of hsaEligible; track hsa; let i = $index) {
                      <div class="custom-control custom-checkbox mr-sm-2 m-b-15">
                        <input
                          type="checkbox"
                          class="custom-control-input checkbox-input"
                          id="checkbox-hsa-{{ i }}"
                          [value]="hsa"
                          (click)="selectedFilter(hsa, $event, 'hsa')"
                        />
                        <label class="custom-control-label" for="checkbox-hsa-{{ i }}"
                          >{{ hsa | planFilter }} <span class="count-text">{{ hsaCounts(hsa) }}</span></label
                        >
                      </div>
                    }
                  </div>
                </div>
                <div class="row">
                  <div class="col-6">
                    <p class="heading-label">
                      Plan Premiums
                      <i
                        class="far fa-question-circle ml-2"
                        placement="right"
                        [ngbTooltip]="getToolTip('planPremiums')"
                      ></i>
                    </p>
                    <div class="row">
                      <label for="pp1"></label>
                      <input
                        type="text"
                        class="form-control col-3 mr-2"
                        id="pp1"
                        (keydown)="validateNumber($event)"
                        [(ngModel)]="planPremiumsFrom"
                        (ngModelChange)="filterCarriers()"
                      />
                      TO
                      <input
                        type="text"
                        class="form-control col-3 ml-2"
                        (keydown)="validateNumber($event)"
                        [(ngModel)]="planPremiumsTo"
                        (ngModelChange)="filterCarriers()"
                      />
                    </div>
                  </div>
                  <div class="col-6">
                    <p class="heading-label">
                      Yearly Medical Deductible
                      <i
                        class="far fa-question-circle ml-2"
                        placement="right"
                        [ngbTooltip]="getToolTip('yearlyMedicalDeductible')"
                      ></i>
                    </p>
                    <div class="row">
                      <label for="ymb1"></label>
                      <input
                        type="text"
                        class="form-control col-3 mr-2"
                        id="ymb1"
                        (keydown)="validateNumber($event)"
                        [(ngModel)]="yearlyMedicalDeductibleFrom"
                        (ngModelChange)="filterCarriers()"
                      />
                      TO
                      <input
                        type="text"
                        class="form-control col-3 ml-2"
                        (keydown)="validateNumber($event)"
                        [(ngModel)]="yearlyMedicalDeductibleTo"
                        (ngModelChange)="filterCarriers()"
                      />
                    </div>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-12">
                    <p class="heading-label">Insurance Company</p>
                  </div>
                </div>
                <div class="row">
                  @for (carrier of carriers; track carrier; let i = $index) {
                    <div class="col-3">
                      <div class="custom-control custom-checkbox mr-sm-2 m-b-15">
                        <input
                          type="checkbox"
                          class="custom-control-input checkbox-input"
                          id="checkbox-carrier-{{ i }}"
                          [value]="carrier"
                          (click)="selectedFilter(carrier, $event, 'insuranceCompany')"
                        />
                        <label class="custom-control-label" for="checkbox-carrier-{{ i }}">{{ carrier }}</label>
                      </div>
                    </div>
                  }
                </div>
                <div class="row mt-4">
                  <div class="col-6 offset-md-8">
                    <div class="row">
                      <div class="col-5 mr-2">
                        <button class="btn btn-primary" (click)="resetAll()">Clear Filters</button>
                      </div>
                      <div class="col-3">
                        <button class="btn btn-success" (click)="isCollapsed = !isCollapsed; displayResults()">
                          Apply
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12">
          <h6 class="font-weight-bold">Displaying {{ filterLength }} Plans</h6>
        </div>
      </div>
      @if (showPlansTable) {
        <div class="row">
          <div class="col-12">
            <div class="card">
              <table class="table table-striped table-bordered" id="plan-table">
                <thead>
                  <tr>
                    <th scope="col">
                      {{ getTableHeader('col-1') }}
                    </th>
                    <th [ngStyle]="{ width: '20%' }" scope="col">
                      {{ getTableHeader('col-2') }}
                      @if (!pdfView && planType() !== 'dental') {
                        <i
                          class="fas fa-question-circle ml-2"
                          placement="right"
                          [ngbTooltip]="getToolTip('benefitCost')"
                        ></i>
                      }
                    </th>
                    <th
                      scope="col"
                      (click)="sortData(getTableHeader('col-3')[0]); setIcon('col-3')"
                      class="clickable-header"
                    >
                      {{ getTableHeader('col-3') }}
                      @if (!pdfView && !showIcon('col-3')) {
                        <i class="fas fa-sort"></i>
                      }
                      @if (!pdfView && showIcon('col-3')) {
                        <i class="fas" [ngClass]="sortDirection ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
                      }
                      @if (!pdfView) {
                        <i
                          class="fas fa-question-circle ml-2"
                          placement="right"
                          [ngbTooltip]="getToolTip('annualDeductibleFamilyIndividual')"
                        ></i>
                      }
                    </th>
                    <th
                      scope="col"
                      (click)="sortData(getTableHeader('col-4')[0]); setIcon('col-4')"
                      class="clickable-header"
                    >
                      {{ getTableHeader('col-4') }}
                      @if (!pdfView && !showIcon('col-4')) {
                        <i class="fas fa-sort"></i>
                      }
                      @if (!pdfView && showIcon('col-4')) {
                        <i class="fas" [ngClass]="sortDirection ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
                      }
                      @if (!pdfView) {
                        <i
                          class="fas fa-question-circle ml-2"
                          placement="right"
                          [ngbTooltip]="getToolTip('maximumOutOfPocket')"
                        ></i>
                      }
                    </th>
                    @if (this.planFilter === 'single_product' && this.planType() !== 'dental') {
                      <th [ngStyle]="{ width: '17%' }" scope="col">
                        {{ getTableHeader('col-5') }}
                        @if (!pdfView) {
                          <i
                            class="fas fa-question-circle ml-2"
                            placement="right"
                            [ngbTooltip]="getToolTip('monthlyCost')"
                          ></i>
                        }
                      </th>
                    }
                    <th
                      scope="col"
                      (click)="sortData(getTableHeader('col-6')[0]); setIcon('col-6')"
                      class="clickable-header"
                    >
                      {{ getTableHeader('col-6') }}
                      @if (!pdfView && !showIcon('col-6')) {
                        <i class="fas fa-sort"></i>
                      }
                      @if (!pdfView && showIcon('col-6')) {
                        <i class="fas" [ngClass]="sortDirection ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
                      }
                      @if (!pdfView) {
                        <i
                          class="fas fa-question-circle ml-2"
                          placement="right"
                          [ngbTooltip]="getToolTip('maximumMonthlyEmployerCost')"
                        ></i>
                      }
                    </th>
                  </tr>
                </thead>
                <tbody>
                  @for (
                    carrier of $any(filteredCarriers)
                      | orderBy: sortFilter : planType() : planFilter : getTableHeader(iconSelected);
                    track carrier
                  ) {
                    <tr>
                      <td>
                        <strong>{{ carrier['product_information']['provider_name'] }}</strong
                        ><br /><strong>{{ carrier['product_name'] }}</strong
                        ><br />
                        @if (!pdfView) {
                          <a href="javascript:void(0);" (click)="getSbcDocument(carrier['product_information']['id'])"
                            >Summary of Benefit Coverage <i class="far fa-file-pdf fa-lg"></i
                          ></a>
                        }
                      </td>
                      <td>
                        @if (planType() === 'health') {
                          <span>
                            <p class="mb-0">
                              <strong>Hospital Stay -</strong>
                              {{ carrier['product_information']['hospital_stay'] | currency }}
                            </p>
                            <p class="mb-0">
                              <strong>Emergency Stay -</strong>
                              {{ carrier['product_information']['emergency_stay'] | currency }}
                            </p>
                            <p class="mb-0">
                              <strong>PCP Office Visit -</strong>
                              {{ carrier['product_information']['pcp_office_visit'] | currency }}
                            </p>
                            <p class="mb-0">
                              <strong>RX -</strong>
                              {{ carrier['product_information']['rx'] | currency }}
                            </p>
                          </span>
                        }
                        @if (planType() === 'dental') {
                          <span>
                            <p class="mb-0">
                              <strong>Preventive Services -</strong>
                              {{ carrier['product_information']['preventive_dental_services'] }}
                            </p>
                            <p class="mb-0">
                              <strong>Basic Services -</strong>
                              {{ carrier['product_information']['basic_dental_services'] }}
                            </p>
                            <p class="mb-0">
                              <strong>Major Services -</strong>
                              {{ carrier['product_information']['major_dental_services'] }}
                            </p>
                          </span>
                        }
                      </td>
                      <td>{{ carrier['group_deductible'] }}</td>
                      <td>{{ carrier['product_information']['out_of_pocket_in_network'] }}</td>

                      <td>{{ carrier['sponsor_cost'] | currency }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      }
      @if (showPlansTable) {
        <div class="row button-group">
          <div class="col-6">
            <button class="btn btn-success" (click)="downloadPdf()" [disabled]="!filterSelected">
              <i class="far fa-file-pdf"></i> Save PDF
            </button>
          </div>
          <div class="col-6">
            <a class="btn btn-primary float-right" [routerLink]="btnLink">{{ btnName }}</a>
          </div>
        </div>
      }
    </div>
  }
</div>
