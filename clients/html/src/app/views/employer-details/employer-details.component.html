@if (isLateRates) {
  @for (alert of alerts; track alert) {
    @if (alert.enabled) {
      <ngb-alert [type]="alert.type" (close)="close(alert)">{{ alert.message }}</ngb-alert>
    }
  }
}
<div class="container mb-5 mt-3">
  <app-nav [validForm]="showEmployeeRoster" myPath="Employer Details" />

  <div class="row ps-3 mt-4">
    <form [formGroup]="quoteForm" class="px-0">
      <div class="row mb-2">
        <div class="col-12">
          <h2 class="heading-text">Employer Information</h2>
        </div>
      </div>

      <div class="row">
        <div class="col-3">
          <div class="form-group d-flex flex-column mb-3">
            <label for="effectiveDate">Effective Date: <span class="required-field">*</span></label>
            <select
              class="form-select ps-2"
              id="inlineFormCustomSelect"
              formControlName="effectiveDate"
              id="effectiveDate"
              (change)="updateEffectiveDate($event)"
            >
              <option selected>SELECT DATE</option>
              @for (date of effectiveDateOptions; track date.value) {
                <option [selected]="isSelected(date.value)" [disabled]="date.disabled" [attr.value]="date.value">
                  {{ date.value | date: 'MMMM, y' }}
                </option>
              }
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-3">
          <div class="form-group mb-3">
            <label for="sicInput">SIC Code: <span class="required-field">*</span></label>

            <ng-autocomplete
              id="sicInput"
              formControlName="sic"
              name="sic"
              [data]="sics"
              [searchKeyword]="sicKeyword"
              [itemTemplate]="sicTemplate"
              [notFoundTemplate]="sicNotFoundTemplate"
              class="inout-fix"
              (selected)="updateSic($event)"
              (inputChanged)="updateChangedSic($event)"
            />

            <ng-template #sicTemplate let-item>
              <a [innerHTML]="item.standardIndustryCodeFull"></a>
            </ng-template>

            <ng-template #sicNotFoundTemplate let-notFound>
              <div [innerHTML]="notFound"></div>
            </ng-template>
          </div>
        </div>

        <div class="col-auto">
          <i class="fas fa-question fa-lg question-icon" (click)="showSicDetails = !showSicDetails"></i>
        </div>

        <div class="col-3">
          <div class="form-group">
            <label for="zip">Business ZIP Code: <span class="required-field">*</span></label>
            <ng-autocomplete
              formControlName="zip"
              id="zip"
              name="zip"
              [debounceTime]="800"
              [data]="zipcodes"
              [searchKeyword]="zipKeyword"
              (selected)="selectEvent($event)"
              (inputChanged)="zipChangeSearch($event)"
              (inputFocused)="onFocused($event)"
              [itemTemplate]="zipTemplate"
              [notFoundTemplate]="zipNotFoundTemplate"
              required
            />

            <ng-template #zipTemplate let-zip>
              <a [innerHTML]="zip"></a>
            </ng-template>

            <ng-template #zipNotFoundTemplate let-zipNotFound>
              <div [innerHTML]="zipNotFound"></div>
            </ng-template>
          </div>
        </div>

        <div class="col-3">
          <div class="form-group">
            <label for="countyField">County:</label>
            <select formControlName="county" class="form-select" id="countyField" (change)="updateCounty($event)">
              @for (county of counties; track county) {
                <option [value]="county.county">{{ county.county }}</option>
              }
            </select>
          </div>
        </div>
      </div>

      @if (showSicDetails) {
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <h5>Search for your matching SIC Code</h5>
                <p class="pt-2 mb-0">
                  SIC (Standard Industrial Classifications) code are used to categorize your business into the
                  appropriate rating group
                </p>
                <p>
                  You can use the browse or search through all the available code -- click a SIC code to make a
                  selection
                </p>
                <app-dropdown-treeview-select />
              </div>
            </div>
          </div>
        </div>
      }

      <div class="row">
        <!-- Row for employees roster text  -->
        <div class="col-md-12 mb-3">
          <h2 class="heading-text">Employee Roster</h2>
          <p>
            Select '<strong>Add Employee</strong>' to manually enter information about employees. Or, choose '<strong
              >Upload Employee Roster</strong
            >' to upload the employee roster template. To use this option, you will need to download the template first,
            then upload the completed version. <br />For each employee you add, you will need their:
          </p>
          <ul>
            @for (detail of employeeRosterDetails; track detail) {
              <li>{{ detail }}</li>
            }
          </ul>
          <p>Note: You may use this complete roster download when you apply.</p>
          <button type="button" class="btn btn-link">
            <a href="/get-a-quote/assets/roster_upload_template.xlsx" download
              ><i class="fas fa-download"></i> Download Roster Template</a
            >
          </button>
        </div>
      </div>
      <!-- End row for employees roster text  -->

      @if (showEmployeeRoster) {
        <div class="mb-4">
          <ngx-datatable
            #censusDatatable
            class="material striped mt-1"
            [rows]="rows"
            [headerHeight]="50"
            [footerHeight]="50"
            [rowHeight]="'auto'"
            [limit]="5"
          >
            <ngx-datatable-column name="First Name">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row['firstName'] }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Last Name">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row['lastName'] }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="DOB">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row['dob'] | date }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Coverage Type">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row['coverageKind'] | coverageType }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Dependent Count">
              <ng-template let-row="row" ngx-datatable-cell-template>
                {{ row['dependents'].length }}
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="">
              <ng-template let-row="row" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                <div ngbDropdown class="d-inline-block" container="body">
                  <button type="button" class="btn btn-outline-primary actions-button" ngbDropdownToggle>
                    Actions
                  </button>
                  <div ngbDropdownMenu>
                    <button type="button" ngbDropdownItem (click)="editEmployee(rowIndex)">Edit</button>
                    <button type="button" ngbDropdownItem (click)="removeEmployeeFromRoster(rowIndex)">Delete</button>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      }

      @if (showEditHousehold) {
        <div class="row ps-2">
          <form [formGroup]="editEmployeeForm">
            <div [@fadeInOut]>
              <fieldset class="household mb-3">
                <legend><h5 class="pt-2">Edit Household</h5></legend>
                <div class="row">
                  <div class="col-3">
                    <div class="form-group">
                      <label for="firstName">First Name</label>
                      <input type="text" class="form-control" formControlName="firstName" placeholder="First Name" />
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="form-group">
                      <label for="lastName">Last Name</label>
                      <input type="text" class="form-control" formControlName="lastName" placeholder="Last Name" />
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="form-group">
                      <label for="dob">DOB <span class="required-field">*</span></label>
                      <input
                        placeholder="mm/dd/yyyy"
                        (input)="formatInputDate($event)"
                        class="form-control"
                        formControlName="dob"
                        ngbDatepicker
                        [minDate]="{ year: 1924, month: 1, day: 1 }"
                        [maxDate]="{ year: 2024, month: 12, day: 31 }"
                        #d="ngbDatepicker"
                        (click)="d.toggle()"
                      />
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="form-group">
                      <label for="coverageKind">Coverage Kind <span class="required-field">*</span></label>
                      <select type="text" class="form-select" formControlName="coverageKind">
                        <option value="both" selected>Both</option>
                        <option value="healthOnly">Health Only</option>
                        <option value="dentalOnly">Dental Only</option>
                      </select>
                    </div>
                  </div>
                  <div class="ps-2 mt-4" formArrayName="dependents">
                    @for (
                      dependent of editEmployeeForm.get('dependents')['controls'];
                      track dependent;
                      let j = $index
                    ) {
                      <div [@fadeInOut]>
                        <fieldset class="dependent">
                          <legend>
                            <h6 class="sub-heading-text">Dependent {{ j + 1 }}</h6>
                          </legend>
                          <div class="row" [formGroupName]="j">
                            <div class="col-3 pb-4">
                              <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  formControlName="firstName"
                                  placeholder="First Name"
                                />
                              </div>
                            </div>
                            <div class="col-3 pb-4">
                              <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  formControlName="lastName"
                                  placeholder="Last Name"
                                />
                              </div>
                            </div>
                            <div class="col-3 pb-4">
                              <div class="form-group">
                                <label for="dob">DOB <span class="required-field">*</span></label>
                                <input
                                  placeholder="mm/dd/yyyy"
                                  (input)="formatInputDate($event)"
                                  class="form-control"
                                  formControlName="dob"
                                  ngbDatepicker
                                  #d="ngbDatepicker"
                                  (click)="d.toggle()"
                                  required
                                />
                              </div>
                            </div>
                            <div class="col-2 pb-4">
                              <div class="form-group">
                                <label for="relationship">Relationship <span class="required-field">*</span></label>
                                <select type="text" class="form-select" formControlName="relationship">
                                  @for (relation of relationOptions; track relation) {
                                    <option [value]="relation.key">{{ relation.value }}</option>
                                  }
                                </select>
                              </div>
                            </div>
                            <div class="col-1 pt-4">
                              <i
                                class="fas fa-trash fa-2x"
                                (click)="deleteDependent(editEmployeeForm.controls.dependents, j)"
                              ></i>
                            </div>
                          </div>
                        </fieldset>
                      </div>
                    }
                  </div>
                  <div class="col-11 d-flex justify-content-end">
                    <button
                      type="button"
                      class="btn btn-link"
                      (click)="addDependent(editEmployeeForm.controls.dependents)"
                    >
                      <i class="fas fa-users"></i> Add Dependent
                    </button>
                  </div>
                  <div class="col-12 d-grid gap-2 d-flex justify-content-end">
                    <button type="button" class="btn btn-primary" (click)="this.showEditHousehold = false">
                      Cancel
                    </button>
                    <button
                      type="button"
                      class="btn btn-primary"
                      [disabled]="validateEmployeeEditForm()"
                      (click)="updateEmployee()"
                    >
                      Update Employee
                    </button>
                  </div>
                </div>
              </fieldset>
            </div>
          </form>
        </div>
      }

      @if (showNewEmployee) {
        <div class="row ps-2">
          <form [formGroup]="addNewEmployeeForm">
            <div [@fadeInOut]>
              <fieldset class="household mb-3">
                <legend><h5 class="pt-2">Add Employee</h5></legend>
                <div class="row">
                  <div class="col-3">
                    <div class="form-group">
                      <label for="firstName">First Name</label>
                      <input type="text" class="form-control" formControlName="firstName" placeholder="First Name" />
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="form-group">
                      <label for="lastName">Last Name</label>
                      <input type="text" class="form-control" formControlName="lastName" placeholder="Last Name" />
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="form-group">
                      <label for="dob">DOB <span class="required-field">*</span></label>
                      <input
                        placeholder="mm/dd/yyyy"
                        (input)="formatInputDate($event)"
                        class="form-control"
                        formControlName="dob"
                        ngbDatepicker
                        #d="ngbDatepicker"
                        (click)="d.toggle()"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="form-group">
                      <label for="coverageKind">Coverage Kind <span class="required-field">*</span></label>
                      <select type="text" class="form-select" formControlName="coverageKind">
                        <option value="both" selected>Both</option>
                        <option value="healthOnly">Health Only</option>
                        <option value="dentalOnly">Dental Only</option>
                      </select>
                    </div>
                  </div>
                  <div class="ps-2 mt-4" formArrayName="dependents">
                    @for (
                      dependent of addNewEmployeeForm.get('dependents')['controls'];
                      track dependent;
                      let j = $index
                    ) {
                      <div [@fadeInOut] class="mb-3">
                        <fieldset class="dependent">
                          <legend>
                            <h6 class="sub-heading-text">Dependent {{ j + 1 }}</h6>
                          </legend>
                          <div class="row" [formGroupName]="j">
                            <div class="col-2">
                              <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  formControlName="firstName"
                                  placeholder="First Name"
                                />
                              </div>
                            </div>
                            <div class="col-2">
                              <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  formControlName="lastName"
                                  placeholder="Last Name"
                                />
                              </div>
                            </div>
                            <div class="col-2">
                              <div class="form-group">
                                <label for="dob">DOB <span class="required-field">*</span></label>
                                <input
                                  placeholder="mm/dd/yyyy"
                                  (input)="formatInputDate($event)"
                                  class="form-control"
                                  formControlName="dob"
                                  ngbDatepicker
                                  #d="ngbDatepicker"
                                  (click)="d.toggle()"
                                  required
                                />
                              </div>
                            </div>
                            <div class="col-2">
                              <div class="form-group">
                                <label for="relationship">Relationship <span class="required-field">*</span></label>
                                <select type="text" class="form-select" formControlName="relationship">
                                  @for (relation of relationOptions; track relation) {
                                    <option [value]="relation.key">{{ relation.value }}</option>
                                  }
                                </select>
                              </div>
                            </div>
                            <div class="col-1 pt-4">
                              <i
                                class="fas fa-trash fa-2x"
                                (click)="deleteDependent(addNewEmployeeForm.controls.dependents, j)"
                              ></i>
                            </div>
                          </div>
                        </fieldset>
                      </div>
                    }
                  </div>
                  <div class="col-11 d-flex justify-content-end">
                    <button
                      type="button"
                      class="btn btn-link"
                      (click)="addDependent(addNewEmployeeForm.controls.dependents)"
                    >
                      <i class="fas fa-users"></i> Add Dependent
                    </button>
                  </div>
                  <div class="col-12 d-grid gap-2 d-flex justify-content-end">
                    <button class="btn btn-primary" type="button" (click)="this.showNewEmployee = false">Cancel</button>
                    <button
                      class="btn btn-primary"
                      type="button"
                      [disabled]="!addNewEmployeeForm.valid"
                      (click)="saveNewEmployee()"
                    >
                      Save Employee
                    </button>
                  </div>
                </div>
              </fieldset>
            </div>
          </form>
        </div>
      }

      @if (showHouseholds) {
        <div class="row ps-2">
          <!-- Row for households  -->
          <div formArrayName="employees">
            <!-- Start employee forms array -->
            @for (employee of quoteForm.get('employees')['controls']; track employee; let i = $index) {
              <div [attr.employee-index]="i" id="employee-hh-card" [@fadeInOut]>
                <!-- starts employee fields -->
                <fieldset class="household mb-3">
                  <legend>
                    <h5 class="pt-2">Employee {{ i + 1 }}</h5>
                  </legend>
                  <div class="row" [formGroupName]="i">
                    <!-- Starts employee form group -->
                    <div class="col-3">
                      <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" class="form-control" formControlName="firstName" placeholder="First Name" />
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" class="form-control" formControlName="lastName" placeholder="Last Name" />
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="form-group">
                        <label for="dob">DOB <span class="required-field">*</span></label>
                        <input
                          placeholder="mm/dd/yyyy"
                          (input)="formatInputDate($event)"
                          class="form-control"
                          [minDate]="minDateForTemplate"
                          [maxDate]="maxDateForTemplate"
                          formControlName="dob"
                          ngbDatepicker
                          #d="ngbDatepicker"
                          (click)="d.toggle()"
                          required
                        />
                      </div>
                    </div>
                    <div class="col-2">
                      <div class="form-group">
                        <label for="coverageKind">Coverage Type <span class="required-field">*</span></label>
                        <select type="text" class="form-select" formControlName="coverageKind">
                          <option value="both" selected>Both</option>
                          <option value="healthOnly">Health Only</option>
                          <option value="dentalOnly">Dental Only</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-1 pt-4">
                      <i class="fas fa-trash fa-2x" (click)="deleteEmployee(i)"></i>
                    </div>
                    <div class="ps-2 mt-4" formArrayName="dependents">
                      <!-- starts depenendts array -->
                      @for (dependent of employee.get('dependents').controls; track dependent; let j = $index) {
                        <div [@fadeInOut] class="mb-3">
                          <fieldset class="dependent">
                            <legend>
                              <h6 class="sub-heading-text">Dependent {{ j + 1 }}</h6>
                            </legend>
                            <div class="row" [formGroupName]="j">
                              <!-- starts dependents row -->
                              <div class="col-2">
                                <div class="form-group">
                                  <label for="firstName">First Name</label>
                                  <input
                                    type="text"
                                    class="form-control"
                                    formControlName="firstName"
                                    placeholder="First Name"
                                  />
                                </div>
                              </div>
                              <div class="col-2">
                                <div class="form-group">
                                  <label for="lastName">Last Name</label>
                                  <input
                                    type="text"
                                    class="form-control"
                                    formControlName="lastName"
                                    placeholder="Last Name"
                                  />
                                </div>
                              </div>
                              <div class="col-2">
                                <div class="form-group">
                                  <label for="dob">DOB <span class="required-field">*</span></label>
                                  <input
                                    placeholder="mm/dd/yyyy"
                                    (input)="formatInputDate($event)"
                                    class="form-control"
                                    formControlName="dob"
                                    ngbDatepicker
                                    #d="ngbDatepicker"
                                    (click)="d.toggle()"
                                    required
                                  />
                                </div>
                              </div>
                              <div class="col-2">
                                <div class="form-group">
                                  <label for="relationship">Relationship <span class="required-field">*</span></label>
                                  <select type="text" class="form-select" formControlName="relationship">
                                    @for (relation of relationOptions; track relation) {
                                      <option [value]="relation.key">{{ relation.value }}</option>
                                    }
                                  </select>
                                </div>
                              </div>
                              <div class="col-1 pt-4">
                                <i
                                  class="fas fa-trash fa-2x"
                                  (click)="deleteDependent(employee.controls.dependents, j)"
                                ></i>
                              </div>
                            </div>
                            <!-- ends dependents row -->
                          </fieldset>
                        </div>
                      }
                    </div>
                    <!-- ends depenendts array -->
                    <div class="col-11 d-flex justify-content-end">
                      <button type="button" class="btn btn-link" (click)="addDependent(employee.controls.dependents)">
                        <i class="fas fa-users"></i> Add Dependent
                      </button>
                    </div>
                  </div>
                  <!-- Ends employee form group -->
                </fieldset>
              </div>
            }
            <!-- end employee fields -->
          </div>
          <!-- Ends employee forms array -->
        </div>
      }
      <!-- End row for households  -->
      <ng-template #content let-c="close" let-d="dismiss"
        ><!-- Template for upload roster  -->
        <div class="modal-header">
          <h4 class="modal-title" id="modal-basic-title">Upload File</h4>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            (click)="d('Cross click')"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="card">
            <div class="card-body">
              <input type="file" id="file" #file (change)="checkFilePresence(file)" />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            (click)="fileUploaded(file)"
            type="button"
            class="btn btn-primary"
            [disabled]="true"
            id="file-upload-btn"
          >
            <i class="fas fa-upload"></i> Upload Employee Roster
          </button>
        </div>
      </ng-template>

      <div class="row mt-3 form-button-group">
        <div class="col-12 d-flex gap-2">
          @if (!showEmployeeRoster) {
            <button type="button" class="btn btn-primary upload-employee-roster" (click)="open(content)">
              <i class="fas fa-upload"></i> Upload Employee Roster
            </button>
          }
          @if (!showEmployeeRoster) {
            <button type="button" (click)="addEmployee()" class="btn btn-primary add-new-employee">
              <i class="fas fa-user-plus"></i> Add Employee
            </button>
          }
          @if (showEmployeeRoster) {
            <button type="button" (click)="addNewEmployee()" class="btn btn-primary add-new-employee">
              <i class="fas fa-user-plus"></i> Add Employee
            </button>
          }
          @if (!showEmployeeRoster) {
            <button
              type="button"
              class="btn btn-success create-roster"
              (click)="createRoster()"
              [disabled]="!quoteForm.valid"
            >
              <i class="fas fa-users"></i> Save Roster
            </button>
          }
          @if (showEmployeeRoster) {
            <a class="btn btn-success view-plans-button ms-auto" routerLink="/employer-details/health"
              ><i class="fas fa-check"></i> View Plans</a
            >
          }
        </div>
      </div>
    </form>
  </div>
</div>
